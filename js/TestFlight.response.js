(()=>{"use strict";var t,e,s={},a={};function i(t){var e=a[t];if(void 0!==e)return e.exports;var n=a[t]={exports:{}};return s[t](n,n.exports,i),n.exports}e=Object.getPrototypeOf?t=>Object.getPrototypeOf(t):t=>t.__proto__,i.t=function(s,a){if(1&a&&(s=this(s)),8&a)return s;if("object"==typeof s&&s){if(4&a&&s.__esModule)return s;if(16&a&&"function"==typeof s.then)return s}var n=Object.create(null);i.r(n);var o={};t=t||[null,e({}),e([]),e(e)];for(var r=2&a&&s;"object"==typeof r&&!~t.indexOf(r);r=e(r))Object.getOwnPropertyNames(r).forEach((t=>o[t]=()=>s[t]));return o.default=()=>s,i.d(n,o),n},i.d=(t,e)=>{for(var s in e)i.o(e,s)&&!i.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})},i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),i.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};class n{constructor(t,e){this.name=`${t}, ENV v1.0.0`,this.http=new o(this),this.data=null,this.dataFile="box.dat",this.logs=[],this.isMute=!1,this.isNeedRewrite=!1,this.logSeparator="\n",this.encoding="utf-8",this.startTime=(new Date).getTime(),Object.assign(this,e),this.log("",`üèÅ ${this.name}, ÂºÄÂßã!`)}Platform(){return"undefined"!=typeof $environment&&$environment["surge-version"]?"Surge":"undefined"!=typeof $environment&&$environment["stash-version"]?"Stash":"undefined"!=typeof $task?"Quantumult X":"undefined"!=typeof $loon?"Loon":"undefined"!=typeof $rocket?"Shadowrocket":void 0}isQuanX(){return"Quantumult X"===this.Platform()}isSurge(){return"Surge"===this.Platform()}isLoon(){return"Loon"===this.Platform()}isShadowrocket(){return"Shadowrocket"===this.Platform()}isStash(){return"Stash"===this.Platform()}toObj(t,e=null){try{return JSON.parse(t)}catch{return e}}toStr(t,e=null){try{return JSON.stringify(t)}catch{return e}}getjson(t,e){let s=e;if(this.getdata(t))try{s=JSON.parse(this.getdata(t))}catch{}return s}setjson(t,e){try{return this.setdata(JSON.stringify(t),e)}catch{return!1}}getScript(t){return new Promise((e=>{this.get({url:t},((t,s,a)=>e(a)))}))}runScript(t,e){return new Promise((s=>{let a=this.getdata("@chavy_boxjs_userCfgs.httpapi");a=a?a.replace(/\n/g,"").trim():a;let i=this.getdata("@chavy_boxjs_userCfgs.httpapi_timeout");i=i?1*i:20,i=e&&e.timeout?e.timeout:i;const[n,o]=a.split("@"),r={url:`http://${o}/v1/scripting/evaluate`,body:{script_text:t,mock_type:"cron",timeout:i},headers:{"X-Key":n,Accept:"*/*"},timeout:i};this.post(r,((t,e,a)=>s(a)))})).catch((t=>this.logErr(t)))}loaddata(){if(!this.isNode())return{};{this.fs=this.fs?this.fs:require("fs"),this.path=this.path?this.path:require("path");const t=this.path.resolve(this.dataFile),e=this.path.resolve(process.cwd(),this.dataFile),s=this.fs.existsSync(t),a=!s&&this.fs.existsSync(e);if(!s&&!a)return{};{const a=s?t:e;try{return JSON.parse(this.fs.readFileSync(a))}catch(t){return{}}}}}writedata(){if(this.isNode()){this.fs=this.fs?this.fs:require("fs"),this.path=this.path?this.path:require("path");const t=this.path.resolve(this.dataFile),e=this.path.resolve(process.cwd(),this.dataFile),s=this.fs.existsSync(t),a=!s&&this.fs.existsSync(e),i=JSON.stringify(this.data);s?this.fs.writeFileSync(t,i):a?this.fs.writeFileSync(e,i):this.fs.writeFileSync(t,i)}}lodash_get(t,e,s=void 0){const a=e.replace(/\[(\d+)\]/g,".$1").split(".");let i=t;for(const t of a)if(i=Object(i)[t],void 0===i)return s;return i}lodash_set(t,e,s){return Object(t)!==t||(Array.isArray(e)||(e=e.toString().match(/[^.[\]]+/g)||[]),e.slice(0,-1).reduce(((t,s,a)=>Object(t[s])===t[s]?t[s]:t[s]=Math.abs(e[a+1])>>0==+e[a+1]?[]:{}),t)[e[e.length-1]]=s),t}getdata(t){let e=this.getval(t);if(/^@/.test(t)){const[,s,a]=/^@(.*?)\.(.*?)$/.exec(t),i=s?this.getval(s):"";if(i)try{const t=JSON.parse(i);e=t?this.lodash_get(t,a,""):e}catch(t){e=""}}return e}setdata(t,e){let s=!1;if(/^@/.test(e)){const[,a,i]=/^@(.*?)\.(.*?)$/.exec(e),n=this.getval(a),o=a?"null"===n?null:n||"{}":"{}";try{const e=JSON.parse(o);this.lodash_set(e,i,t),s=this.setval(JSON.stringify(e),a)}catch(e){const n={};this.lodash_set(n,i,t),s=this.setval(JSON.stringify(n),a)}}else s=this.setval(t,e);return s}getval(t){switch(this.Platform()){case"Surge":case"Loon":case"Stash":case"Shadowrocket":return $persistentStore.read(t);case"Quantumult X":return $prefs.valueForKey(t);default:return this.data&&this.data[t]||null}}setval(t,e){switch(this.Platform()){case"Surge":case"Loon":case"Stash":case"Shadowrocket":return $persistentStore.write(t,e);case"Quantumult X":return $prefs.setValueForKey(t,e);default:return this.data&&this.data[e]||null}}initGotEnv(t){this.got=this.got?this.got:require("got"),this.cktough=this.cktough?this.cktough:require("tough-cookie"),this.ckjar=this.ckjar?this.ckjar:new this.cktough.CookieJar,t&&(t.headers=t.headers?t.headers:{},void 0===t.headers.Cookie&&void 0===t.cookieJar&&(t.cookieJar=this.ckjar))}get(t,e=(()=>{})){switch(delete t.headers?.["Content-Length"],delete t.headers?.["content-length"],this.Platform()){case"Surge":case"Loon":case"Stash":case"Shadowrocket":default:this.isSurge()&&this.isNeedRewrite&&this.lodash_set(t,"headers.X-Surge-Skip-Scripting",!1),$httpClient.get(t,((t,s,a)=>{!t&&s&&(s.body=a,s.statusCode=s.status?s.status:s.statusCode,s.status=s.statusCode),e(t,s,a)}));break;case"Quantumult X":this.isNeedRewrite&&this.lodash_set(t,"opts.hints",!1),$task.fetch(t).then((t=>{const{statusCode:s,statusCode:a,headers:i,body:n,bodyBytes:o}=t;e(null,{status:s,statusCode:a,headers:i,body:n,bodyBytes:o},n,o)}),(t=>e(t&&t.erroror||"UndefinedError")))}}post(t,e=(()=>{})){const s=t.method?t.method.toLocaleLowerCase():"post";switch(t.body&&t.headers&&!t.headers["Content-Type"]&&!t.headers["content-type"]&&(t.headers["content-type"]="application/x-www-form-urlencoded"),delete t.headers?.["Content-Length"],delete t.headers?.["content-length"],this.Platform()){case"Surge":case"Loon":case"Stash":case"Shadowrocket":default:this.isSurge()&&this.isNeedRewrite&&this.lodash_set(t,"headers.X-Surge-Skip-Scripting",!1),$httpClient[s](t,((t,s,a)=>{!t&&s&&(s.body=a,s.statusCode=s.status?s.status:s.statusCode,s.status=s.statusCode),e(t,s,a)}));break;case"Quantumult X":t.method=s,this.isNeedRewrite&&this.lodash_set(t,"opts.hints",!1),$task.fetch(t).then((t=>{const{statusCode:s,statusCode:a,headers:i,body:n,bodyBytes:o}=t;e(null,{status:s,statusCode:a,headers:i,body:n,bodyBytes:o},n,o)}),(t=>e(t&&t.erroror||"UndefinedError")))}}time(t,e=null){const s=e?new Date(e):new Date;let a={"M+":s.getMonth()+1,"d+":s.getDate(),"H+":s.getHours(),"m+":s.getMinutes(),"s+":s.getSeconds(),"q+":Math.floor((s.getMonth()+3)/3),S:s.getMilliseconds()};/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(s.getFullYear()+"").substr(4-RegExp.$1.length)));for(let e in a)new RegExp("("+e+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?a[e]:("00"+a[e]).substr((""+a[e]).length)));return t}msg(t=name,e="",s="",a){const i=t=>{switch(typeof t){case void 0:return t;case"string":switch(this.Platform()){case"Surge":case"Stash":default:return{url:t};case"Loon":case"Shadowrocket":return t;case"Quantumult X":return{"open-url":t}}case"object":switch(this.Platform()){case"Surge":case"Stash":case"Shadowrocket":default:return{url:t.url||t.openUrl||t["open-url"]};case"Loon":return{openUrl:t.openUrl||t.url||t["open-url"],mediaUrl:t.mediaUrl||t["media-url"]};case"Quantumult X":return{"open-url":t["open-url"]||t.url||t.openUrl,"media-url":t["media-url"]||t.mediaUrl,"update-pasteboard":t["update-pasteboard"]||t.updatePasteboard}}default:return}};if(!this.isMute)switch(this.Platform()){case"Surge":case"Loon":case"Stash":case"Shadowrocket":default:$notification.post(t,e,s,i(a));break;case"Quantumult X":$notify(t,e,s,i(a))}if(!this.isMuteLog){let a=["","==============üì£Á≥ªÁªüÈÄöÁü•üì£=============="];a.push(t),e&&a.push(e),s&&a.push(s),console.log(a.join("\n")),this.logs=this.logs.concat(a)}}log(...t){t.length>0&&(this.logs=[...this.logs,...t]),console.log(t.join(this.logSeparator))}logErr(t){this.Platform(),this.log("",`‚ùóÔ∏è ${this.name}, ÈîôËØØ!`,t)}wait(t){return new Promise((e=>setTimeout(e,t)))}done(t={}){const e=((new Date).getTime()-this.startTime)/1e3;this.log("",`üö© ${this.name}, ÁªìÊùü! üïõ ${e} Áßí`),this.log(),this.Platform(),$done(t)}getENV(t,e,s){let a=this.getjson(t,s),i={};if("undefined"!=typeof $argument&&Boolean($argument)){let t=Object.fromEntries($argument.split("&").map((t=>t.split("=").map((t=>t.replace(/\"/g,""))))));for(let e in t)this.setPath(i,e,t[e])}const n={Settings:s?.Default?.Settings||{},Configs:s?.Default?.Configs||{},Caches:{}};Array.isArray(e)||(e=[e]);for(let t of e)n.Settings={...n.Settings,...s?.[t]?.Settings,...i,...a?.[t]?.Settings},n.Configs={...n.Configs,...s?.[t]?.Configs},a?.[t]?.Caches&&"string"==typeof a?.[t]?.Caches&&(a[t].Caches=JSON.parse(a?.[t]?.Caches)),n.Caches={...n.Caches,...a?.[t]?.Caches};return this.traverseObject(n.Settings,((t,e)=>("true"===e||"false"===e?e=JSON.parse(e):"string"==typeof e&&(e=e.includes(",")?e.split(",").map((t=>this.string2number(t))):this.string2number(e)),e))),n}setPath(t,e,s){e.split(".").reduce(((t,a,i)=>t[a]=e.split(".").length===++i?s:t[a]||{}),t)}traverseObject(t,e){for(var s in t){var a=t[s];t[s]="object"==typeof a&&null!==a?this.traverseObject(a,e):e(s,a)}return t}string2number(t){return t&&!isNaN(t)&&(t=parseInt(t,10)),t}}class o{constructor(t){this.env=t}send(t,e="GET"){t="string"==typeof t?{url:t}:t;let s=this.get;return"POST"===e&&(s=this.post),new Promise(((e,a)=>{s.call(this,t,((t,s,i)=>{t?a(t):e(s)}))}))}get(t){return this.send.call(this.env,t)}post(t){return this.send.call(this.env,t,"POST")}}const r=new n("Ô£ø iRingo: Set Environment Variables"),l=JSON.parse('{"Settings":{"Switch":true},"Configs":{"Storefront":[["AE","143481"],["AF","143610"],["AG","143540"],["AI","143538"],["AL","143575"],["AM","143524"],["AO","143564"],["AR","143505"],["AT","143445"],["AU","143460"],["AZ","143568"],["BA","143612"],["BB","143541"],["BD","143490"],["BE","143446"],["BF","143578"],["BG","143526"],["BH","143559"],["BJ","143576"],["BM","143542"],["BN","143560"],["BO","143556"],["BR","143503"],["BS","143539"],["BT","143577"],["BW","143525"],["BY","143565"],["BZ","143555"],["CA","143455"],["CD","143613"],["CG","143582"],["CH","143459"],["CI","143527"],["CL","143483"],["CM","143574"],["CN","143465"],["CO","143501"],["CR","143495"],["CV","143580"],["CY","143557"],["CZ","143489"],["DE","143443"],["DK","143458"],["DM","143545"],["DO","143508"],["DZ","143563"],["EC","143509"],["EE","143518"],["EG","143516"],["ES","143454"],["FI","143447"],["FJ","143583"],["FM","143591"],["FR","143442"],["GA","143614"],["GB","143444"],["GD","143546"],["GF","143615"],["GH","143573"],["GM","143584"],["GR","143448"],["GT","143504"],["GW","143585"],["GY","143553"],["HK","143463"],["HN","143510"],["HR","143494"],["HU","143482"],["ID","143476"],["IE","143449"],["IL","143491"],["IN","143467"],["IQ","143617"],["IS","143558"],["IT","143450"],["JM","143511"],["JO","143528"],["JP","143462"],["KE","143529"],["KG","143586"],["KH","143579"],["KN","143548"],["KP","143466"],["KR","143466"],["KW","143493"],["KY","143544"],["KZ","143517"],["TC","143552"],["TD","143581"],["TJ","143603"],["TH","143475"],["TM","143604"],["TN","143536"],["TO","143608"],["TR","143480"],["TT","143551"],["TW","143470"],["TZ","143572"],["LA","143587"],["LB","143497"],["LC","143549"],["LI","143522"],["LK","143486"],["LR","143588"],["LT","143520"],["LU","143451"],["LV","143519"],["LY","143567"],["MA","143620"],["MD","143523"],["ME","143619"],["MG","143531"],["MK","143530"],["ML","143532"],["MM","143570"],["MN","143592"],["MO","143515"],["MR","143590"],["MS","143547"],["MT","143521"],["MU","143533"],["MV","143488"],["MW","143589"],["MX","143468"],["MY","143473"],["MZ","143593"],["NA","143594"],["NE","143534"],["NG","143561"],["NI","143512"],["NL","143452"],["NO","143457"],["NP","143484"],["NR","143606"],["NZ","143461"],["OM","143562"],["PA","143485"],["PE","143507"],["PG","143597"],["PH","143474"],["PK","143477"],["PL","143478"],["PT","143453"],["PW","143595"],["PY","143513"],["QA","143498"],["RO","143487"],["RS","143500"],["RU","143469"],["RW","143621"],["SA","143479"],["SB","143601"],["SC","143599"],["SE","143456"],["SG","143464"],["SI","143499"],["SK","143496"],["SL","143600"],["SN","143535"],["SR","143554"],["ST","143598"],["SV","143506"],["SZ","143602"],["UA","143492"],["UG","143537"],["US","143441"],["UY","143514"],["UZ","143566"],["VC","143550"],["VE","143502"],["VG","143543"],["VN","143471"],["VU","143609"],["XK","143624"],["YE","143571"],["ZA","143472"],["ZM","143622"],["ZW","143605"]]}}');var c=i.t(l,2);const p=JSON.parse('{"Settings":{"Switch":true,"PEP":{"GCC":"US"},"Services":{"PlaceData":"CN","Directions":"AUTO","Traffic":"AUTO","RAP":"XX","Tiles":"AUTO"},"Geo_manifest":{"Dynamic":{"Config":{"Country_code":{"default":"AUTO","iOS":"CN","iPadOS":"CN","watchOS":"US","macOS":"CN"}}}},"Config":{"Announcements":{"Environment:":{"default":"AUTO","iOS":"CN","iPadOS":"CN","watchOS":"XX","macOS":"CN"}},"Defaults":{"LagunaBeach":true,"DrivingMultiWaypointRoutesEnabled":true,"GEOAddressCorrection":true,"LookupMaxParametersCount":true,"LocalitiesAndLandmarks":true,"POIBusyness":true,"PedestrianAR":true,"6694982d2b14e95815e44e970235e230":true,"OpticalHeading":true,"UseCLPedestrianMapMatchedLocations":true,"TransitPayEnabled":true,"SupportsOffline":true,"SupportsCarIntegration":true,"WiFiQualityNetworkDisabled":false,"WiFiQualityTileDisabled":false}}}}');var h=i.t(p,2);const u=JSON.parse('{"Settings":{"Switch":true,"CountryCode":"US","newsPlusUser":true}}');var d=i.t(u,2);const m=JSON.parse('{"Settings":{"Switch":true,"CountryCode":"US","canUse":true}}');var g=i.t(m,2);const S=JSON.parse('{"Settings":{"Switch":true,"CountryCode":"SG","Domains":["web","itunes","app_store","movies","restaurants","maps"],"Functions":["flightutilities","lookup","mail","messages","news","safari","siri","spotlight","visualintelligence"],"Safari_Smart_History":true},"Configs":{"VisualIntelligence":{"enabled_domains":["pets","media","books","art","nature","landmarks"],"supported_domains":["ART","BOOK","MEDIA","LANDMARK","ANIMALS","BIRDS","FOOD","SIGN_SYMBOL","AUTO_SYMBOL","DOGS","NATURE","NATURAL_LANDMARK","INSECTS","REPTILES","ALBUM","STOREFRONT","LAUNDRY_CARE_SYMBOL","CATS","OBJECT_2D","SCULPTURE","SKYLINE","MAMMALS"]}}}');var f=i.t(S,2);const y=JSON.parse('{"Settings":{"Switch":"true","CountryCode":"US","MultiAccount":"false","Universal":"true"}}');var v=i.t(y,2);const b=JSON.parse('{"Settings":{"Switch":true,"Third-Party":false,"HLSUrl":"play-edge.itunes.apple.com","ServerUrl":"play.itunes.apple.com","Tabs":["WatchNow","Originals","MLS","Sports","Kids","Store","Movies","TV","ChannelsAndApps","Library","Search"],"CountryCode":{"Configs":"AUTO","Settings":"AUTO","View":["SG","TW"],"WatchNow":"AUTO","Channels":"AUTO","Originals":"AUTO","Sports":"US","Kids":"US","Store":"AUTO","Movies":"AUTO","TV":"AUTO","Persons":"SG","Search":"AUTO","Others":"AUTO"}},"Configs":{"Locale":[["AU","en-AU"],["CA","en-CA"],["GB","en-GB"],["KR","ko-KR"],["HK","yue-Hant"],["JP","ja-JP"],["MO","zh-Hant"],["TW","zh-Hant"],["US","en-US"],["SG","zh-Hans"]],"Tabs":[{"title":"‰∏ªÈ°µ","type":"WatchNow","universalLinks":["https://tv.apple.com/watch-now","https://tv.apple.com/home"],"destinationType":"Target","target":{"id":"tahoma_watchnow","type":"Root","url":"https://tv.apple.com/watch-now"},"isSelected":true},{"title":"Apple TV+","type":"Originals","universalLinks":["https://tv.apple.com/channel/tvs.sbd.4000","https://tv.apple.com/atv"],"destinationType":"Target","target":{"id":"tvs.sbd.4000","type":"Brand","url":"https://tv.apple.com/us/channel/tvs.sbd.4000"}},{"title":"MLS Season Pass","type":"MLS","universalLinks":["https://tv.apple.com/mls"],"destinationType":"Target","target":{"id":"tvs.sbd.7000","type":"Brand","url":"https://tv.apple.com/us/channel/tvs.sbd.7000"}},{"title":"‰ΩìËÇ≤ËäÇÁõÆ","type":"Sports","universalLinks":["https://tv.apple.com/sports"],"destinationType":"Target","target":{"id":"tahoma_sports","type":"Root","url":"https://tv.apple.com/sports"}},{"title":"ÂÑøÁ´•","type":"Kids","universalLinks":["https://tv.apple.com/kids"],"destinationType":"Target","target":{"id":"tahoma_kids","type":"Root","url":"https://tv.apple.com/kids"}},{"title":"ÁîµÂΩ±","type":"Movies","universalLinks":["https://tv.apple.com/movies"],"destinationType":"Target","target":{"id":"tahoma_movies","type":"Root","url":"https://tv.apple.com/movies"}},{"title":"ÁîµËßÜËäÇÁõÆ","type":"TV","universalLinks":["https://tv.apple.com/tv-shows"],"destinationType":"Target","target":{"id":"tahoma_tvshows","type":"Root","url":"https://tv.apple.com/tv-shows"}},{"title":"ÂïÜÂ∫ó","type":"Store","universalLinks":["https://tv.apple.com/store"],"destinationType":"SubTabs","subTabs":[{"title":"ÁîµÂΩ±","type":"Movies","universalLinks":["https://tv.apple.com/movies"],"destinationType":"Target","target":{"id":"tahoma_movies","type":"Root","url":"https://tv.apple.com/movies"}},{"title":"ÁîµËßÜËäÇÁõÆ","type":"TV","universalLinks":["https://tv.apple.com/tv-shows"],"destinationType":"Target","target":{"id":"tahoma_tvshows","type":"Root","url":"https://tv.apple.com/tv-shows"}}]},{"title":"È¢ëÈÅìÂíå App","destinationType":"SubTabs","subTabsPlacementType":"ExpandedList","type":"ChannelsAndApps","subTabs":[]},{"title":"ËµÑÊñôÂ∫ì","type":"Library","destinationType":"Client"},{"title":"ÊêúÁ¥¢","type":"Search","universalLinks":["https://tv.apple.com/search"],"destinationType":"Target","target":{"id":"tahoma_search","type":"Root","url":"https://tv.apple.com/search"}}],"i18n":{"WatchNow":[["en","Home"],["zh","‰∏ªÈ°µ"],["zh-Hans","‰∏ªÈ†Å"],["zh-Hant","‰∏ªÈ†Å"]],"Movies":[["en","Movies"],["zh","ÁîµÂΩ±"],["zh-Hans","ÁîµÂΩ±"],["zh-Hant","ÈõªÂΩ±"]],"TV":[["en","TV"],["zh","ÁîµËßÜËäÇÁõÆ"],["zh-Hans","ÁîµËßÜËäÇÁõÆ"],["zh-Hant","ÈõªË¶ñÁØÄÁõÆ"]],"Store":[["en","Store"],["zh","ÂïÜÂ∫ó"],["zh-Hans","ÂïÜÂ∫ó"],["zh-Hant","ÂïÜÂ∫ó"]],"Sports":[["en","Sports"],["zh","‰ΩìËÇ≤ËäÇÁõÆ"],["zh-Hans","‰ΩìËÇ≤ËäÇÁõÆ"],["zh-Hant","È´îËÇ≤ÁØÄÁõÆ"]],"Kids":[["en","Kids"],["zh","ÂÑøÁ´•"],["zh-Hans","ÂÑøÁ´•"],["zh-Hant","ÂÖíÁ´•"]],"Library":[["en","Library"],["zh","ËµÑÊñôÂ∫ì"],["zh-Hans","ËµÑÊñôÂ∫ì"],["zh-Hant","Ë≥áÊñôÂ∫´"]],"Search":[["en","Search"],["zh","ÊêúÁ¥¢"],["zh-Hans","ÊêúÁ¥¢"],["zh-Hant","ËíêÁ¥¢"]]}}}');var T=i.t(b,2);const C=new n("Ô£ø iRingo: ‚úà TestFlight v3.1.1(1) response"),O=new class{constructor(t=[]){this.name="URI v1.2.6",this.opts=t,this.json={scheme:"",host:"",path:"",query:{}}}parse(t){let e=t.match(/(?:(?<scheme>.+):\/\/(?<host>[^/]+))?\/?(?<path>[^?]+)?\??(?<query>[^?]+)?/)?.groups??null;if(e?.path?e.paths=e.path.split("/"):e.path="",e?.paths){const t=e.paths[e.paths.length-1];if(t?.includes(".")){const s=t.split(".");e.format=s[s.length-1]}}return e?.query&&(e.query=Object.fromEntries(e.query.split("&").map((t=>t.split("="))))),e}stringify(t=this.json){let e="";return t?.scheme&&t?.host&&(e+=t.scheme+"://"+t.host),t?.path&&(e+=t?.host?"/"+t.path:t.path),t?.query&&(e+="?"+Object.entries(t.query).map((t=>t.join("="))).join("&")),e}},$={Default:c,Location:h,News:d,PrivateRelay:g,Siri:f,TestFlight:v,TV:T},w=O.parse($request.url);C.log(`‚ö† ${C.name}`,`URL: ${JSON.stringify(w)}`,"");const A=$request.method,L=w.host,N=w.path,M=w.paths;C.log(`‚ö† ${C.name}`,`METHOD: ${A}`,"");const k=($response.headers?.["Content-Type"]??$response.headers?.["content-type"])?.split(";")?.[0];function P(t){switch(t.platform||t.name){case"ios":C.log(`üöß ${C.name}, ios`,""),t=e(t);break;case"osx":C.log(`üöß ${C.name}, osx`,""),!0===t?.macBuildCompatibility?.runsOnAppleSilicon&&(C.log(`üöß ${C.name}, runsOnAppleSilicon`,""),t=e(t));break;case"appletvos":C.log(`üöß ${C.name}, appletvos`,"");break;default:C.log(`üöß ${C.name}, unknown platform: ${t.platform||t.name}`,"")}return t;function e(t){return t.compatible=!0,t.platformCompatible=!0,t.hardwareCompatible=!0,t.osCompatible=!0,t?.permission&&(t.permission="install"),t?.deviceFamilyInfo&&(t.deviceFamilyInfo=[{number:1,name:"iOS",iconUrl:"https://itunesconnect-mr.itunes.apple.com/itc/img/device-icons/device_family_icon_1.png"},{number:2,name:"iPad",iconUrl:"https://itunesconnect-mr.itunes.apple.com/itc/img/device-icons/device_family_icon_2.png"},{number:3,name:"Apple TV",iconUrl:"https://itunesconnect-mr.itunes.apple.com/itc/img/device-icons/device_family_icon_3.png"}]),t?.compatibilityData?.compatibleDeviceFamilies&&(t.compatibilityData.compatibleDeviceFamilies=[{name:"iPad",minimumSupportedDevice:null,unsupportedDevices:[]},{name:"iPhone",minimumSupportedDevice:null,unsupportedDevices:[]},{name:"iPod",minimumSupportedDevice:null,unsupportedDevices:[]},{name:"Mac",minimumSupportedDevice:null,unsupportedDevices:[]}]),t.macBuildCompatibility&&(t.macBuildCompatibility.runsOnIntel=!0,t.macBuildCompatibility.runsOnAppleSilicon=!0),t}}C.log(`‚ö† ${C.name}`,`FORMAT: ${k}`,""),(async()=>{const{Settings:t,Caches:e,Configs:s}=function(t,e,s){r.log(`‚òëÔ∏è ${r.name}`,"");let{Settings:a,Caches:i,Configs:n}=r.getENV("iRingo","TestFlight",s);if(a?.Tabs&&!Array.isArray(a?.Tabs)&&r.lodash_set(a,"Tabs",a?.Tabs?[a.Tabs.toString()]:[]),a?.Domains&&!Array.isArray(a?.Domains)&&r.lodash_set(a,"Domains",a?.Domains?[a.Domains.toString()]:[]),a?.Functions&&!Array.isArray(a?.Functions)&&r.lodash_set(a,"Functions",a?.Functions?[a.Functions.toString()]:[]),r.log(`‚úÖ ${r.name}`,"Settings: "+typeof a,`SettingsÂÜÖÂÆπ: ${JSON.stringify(a)}`,""),n.Storefront=new Map(n.Storefront),n.Locale&&(n.Locale=new Map(n.Locale)),n.i18n)for(let t in n.i18n)n.i18n[t]=new Map(n.i18n[t]);return{Settings:a,Caches:i,Configs:n}}(0,0,$);switch(C.log(`‚ö† ${C.name}`,`Settings.Switch: ${t?.Switch}`,""),t.Switch){case!0:default:let s={};switch(k){case void 0:case"application/x-www-form-urlencoded":case"text/plain":case"text/html":default:case"application/x-mpegURL":case"application/x-mpegurl":case"application/vnd.apple.mpegurl":case"audio/mpegurl":case"text/xml":case"text/plist":case"application/xml":case"application/plist":case"application/x-plist":case"text/vtt":case"application/vtt":break;case"text/json":case"application/json":if(s=JSON.parse($response.body??"{}"),"testflight.apple.com"===L)switch(N){case"v1/session/authenticate":if(!0===t.MultiAccount){C.log(`‚ö† ${C.name}, ÂêØÁî®Â§öË¥¶Âè∑ÊîØÊåÅ`,"");const t=$request?.headers?.["X-Request-Id"]??$request?.headers?.["x-request-id"],a=$request?.headers?.["X-Session-Id"]??$request?.headers?.["x-session-id"],i=$request?.headers?.["X-Session-Digest"]??$request?.headers?.["x-session-digest"];e?.data?(C.log(`‚ö† ${C.name}, ÊúâCaches.data`,""),s?.data?.accountId===e?.data?.accountId&&(C.log(`‚ö† ${C.name}, Account IDÁõ∏Á≠âÔºåÂà∑Êñ∞ÁºìÂ≠ò`,""),e.headers={"X-Request-Id":t,"X-Session-Id":a,"X-Session-Digest":i},e.data=s.data,e.data.termsAndConditions=null,e.data.hasNewTermsAndConditions=!1,C.setjson(e,"@iRingo.TestFlight.Caches"))):(C.log(`‚ö† ${C.name}, CachesÁ©∫ÔºåÂÜôÂÖ•`,""),e.headers={"X-Request-Id":t,"X-Session-Id":a,"X-Session-Digest":i},e.data=s.data,e.data.termsAndConditions=null,e.data.hasNewTermsAndConditions=!1,C.setjson(e,"@iRingo.TestFlight.Caches"))}break;case"v1/devices":case"v1/devices/apns":case"v1/devices/add":case"v1/devices/remove":break;default:switch(M[0]){case"v1":case"v2":case"v3":switch(M[1]){case"accounts":if("settings"===M[2])switch(M[3]){case void 0:break;case"notifications":M[4]}else switch(M[3]){case void 0:break;case"apps":if(void 0===M[4])C.log(`üöß ${C.name}, ${M[0]}/accounts/${M[2]}/apps`,""),!0===t.Universal&&(C.log(`üöß ${C.name}, ÂêØÁî®ÈÄöÁî®Â∫îÁî®ÊîØÊåÅ`,""),null===s.error&&(C.log(`üöß ${C.name}, Êï∞ÊçÆÊó†ÈîôËØØ`,""),s.data=s.data.map((t=>(!1!==t.previouslyTested&&(C.log(`üöß ${C.name}, ‰∏çÊòØÂâçÊµãËØï‰∫∫Âëò`,""),t.platforms=t.platforms.map((t=>(t.build=P(t.build),t)))),t)))));else switch(M[5]){case void 0:break;case"builds":void 0===M[7]&&(C.log(`üöß ${C.name}, ${M[0]}/accounts/${M[2]}/apps/${M[4]}/builds/${M[6]}`,""),!0===t.Universal&&(C.log(`üöß ${C.name}, ÂêØÁî®ÈÄöÁî®Â∫îÁî®ÊîØÊåÅ`,""),null===s.error&&(C.log(`üöß ${C.name}, Êï∞ÊçÆÊó†ÈîôËØØ`,""),s.data.currentBuild=P(s.data.currentBuild),s.data.builds=s.data.builds.map((t=>P(t))))));break;case"platforms":switch(M[6],M[7]){case void 0:break;case"trains":switch(M[9]){case void 0:break;case"builds":void 0===M[10]&&(C.log(`üöß ${C.name}, ${M[0]}/accounts/${M[2]}/apps/${M[4]}/platforms/${M[6]}/trains/${M[8]}/builds`,""),!0===t.Universal&&(C.log(`üöß ${C.name}, ÂêØÁî®ÈÄöÁî®Â∫îÁî®ÊîØÊåÅ`,""),null===s.error&&(C.log(`üöß ${C.name}, Êï∞ÊçÆÊó†ÈîôËØØ`,""),s.data=s.data.map((t=>P(t))))))}}}}break;case"apps":"install"===M[3]&&M[4];break;case"messages":M[2],M[3]}}}$response.body=JSON.stringify(s);case"application/protobuf":case"application/x-protobuf":case"application/vnd.google.protobuf":case"application/grpc":case"application/grpc+proto":case"applecation/octet-stream":}case!1:}})().catch((t=>C.logErr(t))).finally((()=>{if(void 0!==$response)if(C.log(`üéâ ${C.name}, finally`,"$response",`FORMAT: ${k}`,""),$response?.headers?.["Content-Encoding"]&&($response.headers["Content-Encoding"]="identity"),$response?.headers?.["content-encoding"]&&($response.headers["content-encoding"]="identity"),C.isQuanX())switch(k){case void 0:C.done({status:$response.status,headers:$response.headers});break;default:C.done({status:$response.status,headers:$response.headers,body:$response.body});break;case"application/protobuf":case"application/x-protobuf":case"application/vnd.google.protobuf":case"application/grpc":case"application/grpc+proto":case"applecation/octet-stream":C.done({status:$response.status,headers:$response.headers,bodyBytes:$response.bodyBytes.buffer.slice($response.bodyBytes.byteOffset,$response.bodyBytes.byteLength+$response.bodyBytes.byteOffset)})}else C.done($response)}))})();