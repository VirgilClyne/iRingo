(()=>{"use strict";var e,t,s={},a={};function r(e){var t=a[e];if(void 0!==t)return t.exports;var o=a[e]={exports:{}};return s[e](o,o.exports,r),o.exports}t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,r.t=function(s,a){if(1&a&&(s=this(s)),8&a)return s;if("object"==typeof s&&s){if(4&a&&s.__esModule)return s;if(16&a&&"function"==typeof s.then)return s}var o=Object.create(null);r.r(o);var i={};e=e||[null,t({}),t([]),t(t)];for(var n=2&a&&s;"object"==typeof n&&!~e.indexOf(n);n=t(n))Object.getOwnPropertyNames(n).forEach((e=>i[e]=()=>s[e]));return i.default=()=>s,r.d(o,i),o},r.d=(e,t)=>{for(var s in t)r.o(t,s)&&!r.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};class o{constructor(e,t){this.name=`${e}, ENV v1.0.0`,this.http=new i(this),this.data=null,this.dataFile="box.dat",this.logs=[],this.isMute=!1,this.isNeedRewrite=!1,this.logSeparator="\n",this.encoding="utf-8",this.startTime=(new Date).getTime(),Object.assign(this,t),this.log("",`üèÅ ${this.name}, ÂºÄÂßã!`)}Platform(){return"undefined"!=typeof $environment&&$environment["surge-version"]?"Surge":"undefined"!=typeof $environment&&$environment["stash-version"]?"Stash":"undefined"!=typeof $task?"Quantumult X":"undefined"!=typeof $loon?"Loon":"undefined"!=typeof $rocket?"Shadowrocket":void 0}isQuanX(){return"Quantumult X"===this.Platform()}isSurge(){return"Surge"===this.Platform()}isLoon(){return"Loon"===this.Platform()}isShadowrocket(){return"Shadowrocket"===this.Platform()}isStash(){return"Stash"===this.Platform()}toObj(e,t=null){try{return JSON.parse(e)}catch{return t}}toStr(e,t=null){try{return JSON.stringify(e)}catch{return t}}getjson(e,t){let s=t;if(this.getdata(e))try{s=JSON.parse(this.getdata(e))}catch{}return s}setjson(e,t){try{return this.setdata(JSON.stringify(e),t)}catch{return!1}}getScript(e){return new Promise((t=>{this.get({url:e},((e,s,a)=>t(a)))}))}runScript(e,t){return new Promise((s=>{let a=this.getdata("@chavy_boxjs_userCfgs.httpapi");a=a?a.replace(/\n/g,"").trim():a;let r=this.getdata("@chavy_boxjs_userCfgs.httpapi_timeout");r=r?1*r:20,r=t&&t.timeout?t.timeout:r;const[o,i]=a.split("@"),n={url:`http://${i}/v1/scripting/evaluate`,body:{script_text:e,mock_type:"cron",timeout:r},headers:{"X-Key":o,Accept:"*/*"},timeout:r};this.post(n,((e,t,a)=>s(a)))})).catch((e=>this.logErr(e)))}loaddata(){if(!this.isNode())return{};{this.fs=this.fs?this.fs:require("fs"),this.path=this.path?this.path:require("path");const e=this.path.resolve(this.dataFile),t=this.path.resolve(process.cwd(),this.dataFile),s=this.fs.existsSync(e),a=!s&&this.fs.existsSync(t);if(!s&&!a)return{};{const a=s?e:t;try{return JSON.parse(this.fs.readFileSync(a))}catch(e){return{}}}}}writedata(){if(this.isNode()){this.fs=this.fs?this.fs:require("fs"),this.path=this.path?this.path:require("path");const e=this.path.resolve(this.dataFile),t=this.path.resolve(process.cwd(),this.dataFile),s=this.fs.existsSync(e),a=!s&&this.fs.existsSync(t),r=JSON.stringify(this.data);s?this.fs.writeFileSync(e,r):a?this.fs.writeFileSync(t,r):this.fs.writeFileSync(e,r)}}lodash_get(e,t,s=void 0){const a=t.replace(/\[(\d+)\]/g,".$1").split(".");let r=e;for(const e of a)if(r=Object(r)[e],void 0===r)return s;return r}lodash_set(e,t,s){return Object(e)!==e||(Array.isArray(t)||(t=t.toString().match(/[^.[\]]+/g)||[]),t.slice(0,-1).reduce(((e,s,a)=>Object(e[s])===e[s]?e[s]:e[s]=Math.abs(t[a+1])>>0==+t[a+1]?[]:{}),e)[t[t.length-1]]=s),e}getdata(e){let t=this.getval(e);if(/^@/.test(e)){const[,s,a]=/^@(.*?)\.(.*?)$/.exec(e),r=s?this.getval(s):"";if(r)try{const e=JSON.parse(r);t=e?this.lodash_get(e,a,""):t}catch(e){t=""}}return t}setdata(e,t){let s=!1;if(/^@/.test(t)){const[,a,r]=/^@(.*?)\.(.*?)$/.exec(t),o=this.getval(a),i=a?"null"===o?null:o||"{}":"{}";try{const t=JSON.parse(i);this.lodash_set(t,r,e),s=this.setval(JSON.stringify(t),a)}catch(t){const o={};this.lodash_set(o,r,e),s=this.setval(JSON.stringify(o),a)}}else s=this.setval(e,t);return s}getval(e){switch(this.Platform()){case"Surge":case"Loon":case"Stash":case"Shadowrocket":return $persistentStore.read(e);case"Quantumult X":return $prefs.valueForKey(e);default:return this.data&&this.data[e]||null}}setval(e,t){switch(this.Platform()){case"Surge":case"Loon":case"Stash":case"Shadowrocket":return $persistentStore.write(e,t);case"Quantumult X":return $prefs.setValueForKey(e,t);default:return this.data&&this.data[t]||null}}initGotEnv(e){this.got=this.got?this.got:require("got"),this.cktough=this.cktough?this.cktough:require("tough-cookie"),this.ckjar=this.ckjar?this.ckjar:new this.cktough.CookieJar,e&&(e.headers=e.headers?e.headers:{},void 0===e.headers.Cookie&&void 0===e.cookieJar&&(e.cookieJar=this.ckjar))}get(e,t=(()=>{})){switch(delete e.headers?.["Content-Length"],delete e.headers?.["content-length"],this.Platform()){case"Surge":case"Loon":case"Stash":case"Shadowrocket":default:this.isSurge()&&this.isNeedRewrite&&this.lodash_set(e,"headers.X-Surge-Skip-Scripting",!1),$httpClient.get(e,((e,s,a)=>{!e&&s&&(s.body=a,s.statusCode=s.status?s.status:s.statusCode,s.status=s.statusCode),t(e,s,a)}));break;case"Quantumult X":this.isNeedRewrite&&this.lodash_set(e,"opts.hints",!1),$task.fetch(e).then((e=>{const{statusCode:s,statusCode:a,headers:r,body:o,bodyBytes:i}=e;t(null,{status:s,statusCode:a,headers:r,body:o,bodyBytes:i},o,i)}),(e=>t(e&&e.erroror||"UndefinedError")))}}post(e,t=(()=>{})){const s=e.method?e.method.toLocaleLowerCase():"post";switch(e.body&&e.headers&&!e.headers["Content-Type"]&&!e.headers["content-type"]&&(e.headers["content-type"]="application/x-www-form-urlencoded"),delete e.headers?.["Content-Length"],delete e.headers?.["content-length"],this.Platform()){case"Surge":case"Loon":case"Stash":case"Shadowrocket":default:this.isSurge()&&this.isNeedRewrite&&this.lodash_set(e,"headers.X-Surge-Skip-Scripting",!1),$httpClient[s](e,((e,s,a)=>{!e&&s&&(s.body=a,s.statusCode=s.status?s.status:s.statusCode,s.status=s.statusCode),t(e,s,a)}));break;case"Quantumult X":e.method=s,this.isNeedRewrite&&this.lodash_set(e,"opts.hints",!1),$task.fetch(e).then((e=>{const{statusCode:s,statusCode:a,headers:r,body:o,bodyBytes:i}=e;t(null,{status:s,statusCode:a,headers:r,body:o,bodyBytes:i},o,i)}),(e=>t(e&&e.erroror||"UndefinedError")))}}time(e,t=null){const s=t?new Date(t):new Date;let a={"M+":s.getMonth()+1,"d+":s.getDate(),"H+":s.getHours(),"m+":s.getMinutes(),"s+":s.getSeconds(),"q+":Math.floor((s.getMonth()+3)/3),S:s.getMilliseconds()};/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(s.getFullYear()+"").substr(4-RegExp.$1.length)));for(let t in a)new RegExp("("+t+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?a[t]:("00"+a[t]).substr((""+a[t]).length)));return e}msg(e=name,t="",s="",a){const r=e=>{switch(typeof e){case void 0:return e;case"string":switch(this.Platform()){case"Surge":case"Stash":default:return{url:e};case"Loon":case"Shadowrocket":return e;case"Quantumult X":return{"open-url":e}}case"object":switch(this.Platform()){case"Surge":case"Stash":case"Shadowrocket":default:return{url:e.url||e.openUrl||e["open-url"]};case"Loon":return{openUrl:e.openUrl||e.url||e["open-url"],mediaUrl:e.mediaUrl||e["media-url"]};case"Quantumult X":return{"open-url":e["open-url"]||e.url||e.openUrl,"media-url":e["media-url"]||e.mediaUrl,"update-pasteboard":e["update-pasteboard"]||e.updatePasteboard}}default:return}};if(!this.isMute)switch(this.Platform()){case"Surge":case"Loon":case"Stash":case"Shadowrocket":default:$notification.post(e,t,s,r(a));break;case"Quantumult X":$notify(e,t,s,r(a))}if(!this.isMuteLog){let a=["","==============üì£Á≥ªÁªüÈÄöÁü•üì£=============="];a.push(e),t&&a.push(t),s&&a.push(s),console.log(a.join("\n")),this.logs=this.logs.concat(a)}}log(...e){e.length>0&&(this.logs=[...this.logs,...e]),console.log(e.join(this.logSeparator))}logErr(e){this.Platform(),this.log("",`‚ùóÔ∏è ${this.name}, ÈîôËØØ!`,e)}wait(e){return new Promise((t=>setTimeout(t,e)))}done(e={}){const t=((new Date).getTime()-this.startTime)/1e3;this.log("",`üö© ${this.name}, ÁªìÊùü! üïõ ${t} Áßí`),this.log(),this.Platform(),$done(e)}getENV(e,t,s){let a=this.getjson(e,s),r={};if("undefined"!=typeof $argument&&Boolean($argument)){let e=Object.fromEntries($argument.split("&").map((e=>e.split("=").map((e=>e.replace(/\"/g,""))))));for(let t in e)this.setPath(r,t,e[t])}const o={Settings:s?.Default?.Settings||{},Configs:s?.Default?.Configs||{},Caches:{}};Array.isArray(t)||(t=[t]);for(let e of t)o.Settings={...o.Settings,...s?.[e]?.Settings,...r,...a?.[e]?.Settings},o.Configs={...o.Configs,...s?.[e]?.Configs},a?.[e]?.Caches&&"string"==typeof a?.[e]?.Caches&&(a[e].Caches=JSON.parse(a?.[e]?.Caches)),o.Caches={...o.Caches,...a?.[e]?.Caches};return this.traverseObject(o.Settings,((e,t)=>("true"===t||"false"===t?t=JSON.parse(t):"string"==typeof t&&(t=t.includes(",")?t.split(",").map((e=>this.string2number(e))):this.string2number(t)),t))),o}setPath(e,t,s){t.split(".").reduce(((e,a,r)=>e[a]=t.split(".").length===++r?s:e[a]||{}),e)}traverseObject(e,t){for(var s in e){var a=e[s];e[s]="object"==typeof a&&null!==a?this.traverseObject(a,t):t(s,a)}return e}string2number(e){return e&&!isNaN(e)&&(e=parseInt(e,10)),e}}class i{constructor(e){this.env=e}send(e,t="GET"){e="string"==typeof e?{url:e}:e;let s=this.get;return"POST"===t&&(s=this.post),new Promise(((t,a)=>{s.call(this,e,((e,s,r)=>{e?a(e):t(s)}))}))}get(e){return this.send.call(this.env,e)}post(e){return this.send.call(this.env,e,"POST")}}const n=new o("Ô£ø iRingo: Set Environment Variables"),c=JSON.parse('{"Settings":{"Switch":true},"Configs":{"Storefront":[["AE","143481"],["AF","143610"],["AG","143540"],["AI","143538"],["AL","143575"],["AM","143524"],["AO","143564"],["AR","143505"],["AT","143445"],["AU","143460"],["AZ","143568"],["BA","143612"],["BB","143541"],["BD","143490"],["BE","143446"],["BF","143578"],["BG","143526"],["BH","143559"],["BJ","143576"],["BM","143542"],["BN","143560"],["BO","143556"],["BR","143503"],["BS","143539"],["BT","143577"],["BW","143525"],["BY","143565"],["BZ","143555"],["CA","143455"],["CD","143613"],["CG","143582"],["CH","143459"],["CI","143527"],["CL","143483"],["CM","143574"],["CN","143465"],["CO","143501"],["CR","143495"],["CV","143580"],["CY","143557"],["CZ","143489"],["DE","143443"],["DK","143458"],["DM","143545"],["DO","143508"],["DZ","143563"],["EC","143509"],["EE","143518"],["EG","143516"],["ES","143454"],["FI","143447"],["FJ","143583"],["FM","143591"],["FR","143442"],["GA","143614"],["GB","143444"],["GD","143546"],["GF","143615"],["GH","143573"],["GM","143584"],["GR","143448"],["GT","143504"],["GW","143585"],["GY","143553"],["HK","143463"],["HN","143510"],["HR","143494"],["HU","143482"],["ID","143476"],["IE","143449"],["IL","143491"],["IN","143467"],["IQ","143617"],["IS","143558"],["IT","143450"],["JM","143511"],["JO","143528"],["JP","143462"],["KE","143529"],["KG","143586"],["KH","143579"],["KN","143548"],["KP","143466"],["KR","143466"],["KW","143493"],["KY","143544"],["KZ","143517"],["TC","143552"],["TD","143581"],["TJ","143603"],["TH","143475"],["TM","143604"],["TN","143536"],["TO","143608"],["TR","143480"],["TT","143551"],["TW","143470"],["TZ","143572"],["LA","143587"],["LB","143497"],["LC","143549"],["LI","143522"],["LK","143486"],["LR","143588"],["LT","143520"],["LU","143451"],["LV","143519"],["LY","143567"],["MA","143620"],["MD","143523"],["ME","143619"],["MG","143531"],["MK","143530"],["ML","143532"],["MM","143570"],["MN","143592"],["MO","143515"],["MR","143590"],["MS","143547"],["MT","143521"],["MU","143533"],["MV","143488"],["MW","143589"],["MX","143468"],["MY","143473"],["MZ","143593"],["NA","143594"],["NE","143534"],["NG","143561"],["NI","143512"],["NL","143452"],["NO","143457"],["NP","143484"],["NR","143606"],["NZ","143461"],["OM","143562"],["PA","143485"],["PE","143507"],["PG","143597"],["PH","143474"],["PK","143477"],["PL","143478"],["PT","143453"],["PW","143595"],["PY","143513"],["QA","143498"],["RO","143487"],["RS","143500"],["RU","143469"],["RW","143621"],["SA","143479"],["SB","143601"],["SC","143599"],["SE","143456"],["SG","143464"],["SI","143499"],["SK","143496"],["SL","143600"],["SN","143535"],["SR","143554"],["ST","143598"],["SV","143506"],["SZ","143602"],["UA","143492"],["UG","143537"],["US","143441"],["UY","143514"],["UZ","143566"],["VC","143550"],["VE","143502"],["VG","143543"],["VN","143471"],["VU","143609"],["XK","143624"],["YE","143571"],["ZA","143472"],["ZM","143622"],["ZW","143605"]]}}');var u=r.t(c,2);const l=JSON.parse('{"Settings":{"Switch":true,"PEP":{"GCC":"US"},"Services":{"PlaceData":"CN","Directions":"AUTO","Traffic":"AUTO","RAP":"XX","Tiles":"AUTO"},"Geo_manifest":{"Dynamic":{"Config":{"Country_code":{"default":"AUTO","iOS":"CN","iPadOS":"CN","watchOS":"US","macOS":"CN"}}}},"Config":{"Announcements":{"Environment:":{"default":"AUTO","iOS":"CN","iPadOS":"CN","watchOS":"XX","macOS":"CN"}},"Defaults":{"LagunaBeach":true,"DrivingMultiWaypointRoutesEnabled":true,"GEOAddressCorrection":true,"LookupMaxParametersCount":true,"LocalitiesAndLandmarks":true,"POIBusyness":true,"PedestrianAR":true,"6694982d2b14e95815e44e970235e230":true,"OpticalHeading":true,"UseCLPedestrianMapMatchedLocations":true,"TransitPayEnabled":true,"SupportsOffline":true,"SupportsCarIntegration":true,"WiFiQualityNetworkDisabled":false,"WiFiQualityTileDisabled":false}}}}');var h=r.t(l,2);const p=JSON.parse('{"Settings":{"Switch":true,"CountryCode":"US","newsPlusUser":true}}');var d=r.t(p,2);const g=JSON.parse('{"Settings":{"Switch":true,"CountryCode":"US","canUse":true}}');var v=r.t(g,2);const S=JSON.parse('{"Settings":{"Switch":true,"CountryCode":"SG","Domains":["web","itunes","app_store","movies","restaurants","maps"],"Functions":["flightutilities","lookup","mail","messages","news","safari","siri","spotlight","visualintelligence"],"Safari_Smart_History":true},"Configs":{"VisualIntelligence":{"enabled_domains":["pets","media","books","art","nature","landmarks"],"supported_domains":["ART","BOOK","MEDIA","LANDMARK","ANIMALS","BIRDS","FOOD","SIGN_SYMBOL","AUTO_SYMBOL","DOGS","NATURE","NATURAL_LANDMARK","INSECTS","REPTILES","ALBUM","STOREFRONT","LAUNDRY_CARE_SYMBOL","CATS","OBJECT_2D","SCULPTURE","SKYLINE","MAMMALS"]}}}');var f=r.t(S,2);const y=JSON.parse('{"Settings":{"Switch":"true","CountryCode":"US","MultiAccount":"false","Universal":"true"}}');var m=r.t(y,2);const b=JSON.parse('{"Settings":{"Switch":true,"Third-Party":false,"HLSUrl":"play-edge.itunes.apple.com","ServerUrl":"play.itunes.apple.com","Tabs":["WatchNow","Originals","MLS","Sports","Kids","Store","Movies","TV","ChannelsAndApps","Library","Search"],"CountryCode":{"Configs":"AUTO","Settings":"AUTO","View":["SG","TW"],"WatchNow":"AUTO","Channels":"AUTO","Originals":"AUTO","Sports":"US","Kids":"US","Store":"AUTO","Movies":"AUTO","TV":"AUTO","Persons":"SG","Search":"AUTO","Others":"AUTO"}},"Configs":{"Locale":[["AU","en-AU"],["CA","en-CA"],["GB","en-GB"],["KR","ko-KR"],["HK","yue-Hant"],["JP","ja-JP"],["MO","zh-Hant"],["TW","zh-Hant"],["US","en-US"],["SG","zh-Hans"]],"Tabs":[{"title":"‰∏ªÈ°µ","type":"WatchNow","universalLinks":["https://tv.apple.com/watch-now","https://tv.apple.com/home"],"destinationType":"Target","target":{"id":"tahoma_watchnow","type":"Root","url":"https://tv.apple.com/watch-now"},"isSelected":true},{"title":"Apple TV+","type":"Originals","universalLinks":["https://tv.apple.com/channel/tvs.sbd.4000","https://tv.apple.com/atv"],"destinationType":"Target","target":{"id":"tvs.sbd.4000","type":"Brand","url":"https://tv.apple.com/us/channel/tvs.sbd.4000"}},{"title":"MLS Season Pass","type":"MLS","universalLinks":["https://tv.apple.com/mls"],"destinationType":"Target","target":{"id":"tvs.sbd.7000","type":"Brand","url":"https://tv.apple.com/us/channel/tvs.sbd.7000"}},{"title":"‰ΩìËÇ≤ËäÇÁõÆ","type":"Sports","universalLinks":["https://tv.apple.com/sports"],"destinationType":"Target","target":{"id":"tahoma_sports","type":"Root","url":"https://tv.apple.com/sports"}},{"title":"ÂÑøÁ´•","type":"Kids","universalLinks":["https://tv.apple.com/kids"],"destinationType":"Target","target":{"id":"tahoma_kids","type":"Root","url":"https://tv.apple.com/kids"}},{"title":"ÁîµÂΩ±","type":"Movies","universalLinks":["https://tv.apple.com/movies"],"destinationType":"Target","target":{"id":"tahoma_movies","type":"Root","url":"https://tv.apple.com/movies"}},{"title":"ÁîµËßÜËäÇÁõÆ","type":"TV","universalLinks":["https://tv.apple.com/tv-shows"],"destinationType":"Target","target":{"id":"tahoma_tvshows","type":"Root","url":"https://tv.apple.com/tv-shows"}},{"title":"ÂïÜÂ∫ó","type":"Store","universalLinks":["https://tv.apple.com/store"],"destinationType":"SubTabs","subTabs":[{"title":"ÁîµÂΩ±","type":"Movies","universalLinks":["https://tv.apple.com/movies"],"destinationType":"Target","target":{"id":"tahoma_movies","type":"Root","url":"https://tv.apple.com/movies"}},{"title":"ÁîµËßÜËäÇÁõÆ","type":"TV","universalLinks":["https://tv.apple.com/tv-shows"],"destinationType":"Target","target":{"id":"tahoma_tvshows","type":"Root","url":"https://tv.apple.com/tv-shows"}}]},{"title":"È¢ëÈÅìÂíå App","destinationType":"SubTabs","subTabsPlacementType":"ExpandedList","type":"ChannelsAndApps","subTabs":[]},{"title":"ËµÑÊñôÂ∫ì","type":"Library","destinationType":"Client"},{"title":"ÊêúÁ¥¢","type":"Search","universalLinks":["https://tv.apple.com/search"],"destinationType":"Target","target":{"id":"tahoma_search","type":"Root","url":"https://tv.apple.com/search"}}],"i18n":{"WatchNow":[["en","Home"],["zh","‰∏ªÈ°µ"],["zh-Hans","‰∏ªÈ†Å"],["zh-Hant","‰∏ªÈ†Å"]],"Movies":[["en","Movies"],["zh","ÁîµÂΩ±"],["zh-Hans","ÁîµÂΩ±"],["zh-Hant","ÈõªÂΩ±"]],"TV":[["en","TV"],["zh","ÁîµËßÜËäÇÁõÆ"],["zh-Hans","ÁîµËßÜËäÇÁõÆ"],["zh-Hant","ÈõªË¶ñÁØÄÁõÆ"]],"Store":[["en","Store"],["zh","ÂïÜÂ∫ó"],["zh-Hans","ÂïÜÂ∫ó"],["zh-Hant","ÂïÜÂ∫ó"]],"Sports":[["en","Sports"],["zh","‰ΩìËÇ≤ËäÇÁõÆ"],["zh-Hans","‰ΩìËÇ≤ËäÇÁõÆ"],["zh-Hant","È´îËÇ≤ÁØÄÁõÆ"]],"Kids":[["en","Kids"],["zh","ÂÑøÁ´•"],["zh-Hans","ÂÑøÁ´•"],["zh-Hant","ÂÖíÁ´•"]],"Library":[["en","Library"],["zh","ËµÑÊñôÂ∫ì"],["zh-Hans","ËµÑÊñôÂ∫ì"],["zh-Hant","Ë≥áÊñôÂ∫´"]],"Search":[["en","Search"],["zh","ÊêúÁ¥¢"],["zh-Hans","ÊêúÁ¥¢"],["zh-Hant","ËíêÁ¥¢"]]}}}');var C=r.t(b,2);const T=new o("Ô£ø iRingo: üì∫ Ô£øTV v3.2.2(1) request"),O=new class{constructor(e=[]){this.name="URI v1.2.6",this.opts=e,this.json={scheme:"",host:"",path:"",query:{}}}parse(e){let t=e.match(/(?:(?<scheme>.+):\/\/(?<host>[^/]+))?\/?(?<path>[^?]+)?\??(?<query>[^?]+)?/)?.groups??null;if(t?.path?t.paths=t.path.split("/"):t.path="",t?.paths){const e=t.paths[t.paths.length-1];if(e?.includes(".")){const s=e.split(".");t.format=s[s.length-1]}}return t?.query&&(t.query=Object.fromEntries(t.query.split("&").map((e=>e.split("="))))),t}stringify(e=this.json){let t="";return e?.scheme&&e?.host&&(t+=e.scheme+"://"+e.host),e?.path&&(t+=e?.host?"/"+e.path:e.path),e?.query&&(t+="?"+Object.entries(e.query).map((e=>e.join("="))).join("&")),t}},w={Default:u,Location:h,News:d,PrivateRelay:v,Siri:f,TestFlight:m,TV:C};const A=O.parse($request.url);T.log(`‚ö† ${T.name}`,`URL: ${JSON.stringify(A)}`,"");const N=$request.method,$=A.host,k=A.path;A.paths,T.log(`‚ö† ${T.name}`,`METHOD: ${N}`,"");const L=($request.headers?.["Content-Type"]??$request.headers?.["content-type"])?.split(";")?.[0];T.log(`‚ö† ${T.name}`,`FORMAT: ${L}`,""),(async()=>{const{Settings:e,Caches:t,Configs:s}=function(e,t,s){n.log(`‚òëÔ∏è ${n.name}`,"");let{Settings:a,Caches:r,Configs:o}=n.getENV("iRingo","TV",s);if(a?.Tabs&&!Array.isArray(a?.Tabs)&&n.lodash_set(a,"Tabs",a?.Tabs?[a.Tabs.toString()]:[]),a?.Domains&&!Array.isArray(a?.Domains)&&n.lodash_set(a,"Domains",a?.Domains?[a.Domains.toString()]:[]),a?.Functions&&!Array.isArray(a?.Functions)&&n.lodash_set(a,"Functions",a?.Functions?[a.Functions.toString()]:[]),n.log(`‚úÖ ${n.name}`,"Settings: "+typeof a,`SettingsÂÜÖÂÆπ: ${JSON.stringify(a)}`,""),o.Storefront=new Map(o.Storefront),o.Locale&&(o.Locale=new Map(o.Locale)),o.i18n)for(let e in o.i18n)o.i18n[e]=new Map(o.i18n[e]);return{Settings:a,Caches:r,Configs:o}}(0,0,w);switch(T.log(`‚ö† ${T.name}`,`Settings.Switch: ${e?.Switch}`,""),e.Switch){case!0:default:let t={},a="Other";switch(N){case"POST":case"PUT":case"PATCH":case"DELETE":switch(L){case void 0:break;case"application/x-www-form-urlencoded":case"text/plain":case"text/html":default:if("uts-api.itunes.apple.com"===$)switch(k){case"uts/v3/favorite-people":case"uts/v3/favorite-teams":case"uts/v2/favorites":case"uts/v2/favorites/add":case"uts/v2/favorites/remove":a="Sports",$request.body&&($request.body=$request.body.replace(/sf=[\d]{6}/,`sf=${s.Storefront.get(e.CountryCode[a])}`))}break;case"application/x-mpegURL":case"application/x-mpegurl":case"application/vnd.apple.mpegurl":case"audio/mpegurl":case"text/xml":case"text/plist":case"application/xml":case"application/plist":case"application/x-plist":case"text/vtt":case"application/vtt":break;case"text/json":case"application/json":switch(t=JSON.parse($request.body??"{}"),$){case"uts-api.itunes.apple.com":"uts/v3/user/settings"===k&&(a="Settings");break;case"umc-tempo-api.apple.com":switch(k){case"v3/channels/scoreboard":case"v3/channels/scoreboard/":a="Sports"}}$request.body=JSON.stringify(t);case"application/protobuf":case"application/x-protobuf":case"application/vnd.google.protobuf":case"application/grpc":case"application/grpc+proto":case"applecation/octet-stream":}case"GET":case"HEAD":case"OPTIONS":case void 0:default:switch($){case"uts-api.itunes.apple.com":parseInt(A.query?.v,10);const t=A.query?.pfm;switch(($request.headers?.["X-Apple-I-Locale"]??$request.headers?.["x-apple-i-locale"])?.split("_"),k){case"uts/v3/configurations":a="Configs","AUTO"!==e.CountryCode[a]&&(A.query.region&&(A.query.region=e.CountryCode[a]??A.query.region),A.query.country&&(A.query.country=e.CountryCode[a]??A.query.country),A.query.sfh&&(A.query.sfh=A.query.sfh.replace(/\d{6}/,s.Storefront.get(e.CountryCode[a]))));break;case"uts/v3/user/settings":a="Settings";break;case"uts/v3/canvases/Roots/watchNow":case"uts/v3/canvases/roots/tahoma_watchnow":case"uts/v3/shelves/uts.col.UpNext":a="WatchNow",e["Third-Party"]&&(A.query.pfm="desktop"===t?"appletv":t);break;case"uts/v3/canvases/Channels/tvs.sbd.4000":case"uts/v3/shelves/uts.col.ChannelUpNext.tvs.sbd.4000":case"uts/v2/brands/appleTvPlus":case"uts/v3/canvases/Channels/tvs.sbd.7000":case"uts/v3/shelves/uts.col.ChannelUpNext.tvs.sbd.7000":case"uts/v3/shelves/edt.col.63bf2052-50b9-44c8-a67e-30e196e19c60":a="Originals";break;case"uts/v3/channels":case"uts/v2/brands":a="Channels";break;case"uts/v3/canvases/Roots/sports":case"uts/v3/shelves/uts.col.PersonalizedLiveSports":case"uts/v3/clock-scores":case"uts/v3/leagues":case"uts/v2/sports/clockscore":case"uts/v2/sports/competitors":case"uts/v2/sports/league":case"uts/v2/sports/leagues":case"uts/v2/sports/statsIdLookup":case"uts/v2/sports/teamsNearMe":case"uts/v3/canvases/Rooms/edt.item.633e0768-2135-43ac-a878-28965b853ec5":case"uts/v3/canvases/Rooms/edt.item.635968ac-89d7-4619-8f5d-8c7890aef813":case"uts/v3/canvases/Rooms/edt.item.62327df1-6874-470e-98b2-a5bbeac509a2":a="Sports",A.query.pfm="desktop"===t?"ipad":t;break;case"uts/v3/canvases/Roots/kids":a="Kids";break;case"uts/v3/canvases/Roots/store":case"uts/v3/canvases/Roots/tahoma_store":a="Store";break;case"uts/v3/canvases/Roots/movies":a="Movies",e["Third-Party"]&&(A.query.pfm="desktop"===t?"ipad":t);break;case"uts/v3/canvases/Roots/tv":a="TV",e["Third-Party"]&&(A.query.pfm="desktop"===t?"ipad":t);break;case"uts/v3/favorite-people":case"uts/v3/favorite-teams":case"uts/v2/favorites":case"uts/v2/favorites/add":case"uts/v2/favorites/remove":a="Sports";break;case"uts/v3/canvases/Roots/tahoma_searchlanding":case"uts/v3/search":case"uts/v3/search/landing":case"uts/v2/search/incremental":case"uts/v2/search/landing":a="Search";break;case"uts/v3/watchlist":case"uts/v2/watchlist/contains":case"uts/v2/watchlist/search":e["Third-Party"]&&(A.query.pfm="desktop"===t?"ipad":t);break;default:"tvs.sbd.4000"===A.query?.ctx_brand?a="Originals":k.includes("uts/v3/canvases/Channels/")||k.includes("uts/v2/brands/")?a="Channels":k.includes("uts/v3/movies/")?a="Movies":k.includes("uts/v3/shows/")?a="TV":k.includes("uts/v3/sporting-events/")||k.includes("uts/v3/canvases/Sports/")?(a="Sports",A.query.pfm="desktop"===t?"ipad":t):a=k.includes("uts/v3/canvases/Persons/")?"Persons":(k.includes("uts/v3/canvases/Rooms/"),"Others")}break;case"umc-tempo-api.apple.com":switch(k){case"v3/register":case"v3/channels/scoreboard":case"v3/channels/scoreboard/":a="Sports";break;default:k.includes("v3/register/")&&(a="Sports")}}T.log(`‚ö† ${T.name}, Type = ${a}, CC = ${e.CountryCode[a]}`);case"CONNECT":case"TRACE":}$request.headers?.["X-Apple-Store-Front"]&&($request.headers["X-Apple-Store-Front"]=s.Storefront.get(e.CountryCode[a])?$request.headers["X-Apple-Store-Front"].replace(/\d{6}/,s.Storefront.get(e.CountryCode[a])):$request.headers["X-Apple-Store-Front"]),$request.headers?.["x-apple-store-front"]&&($request.headers["x-apple-store-front"]=s.Storefront.get(e.CountryCode[a])?$request.headers["x-apple-store-front"].replace(/\d{6}/,s.Storefront.get(e.CountryCode[a])):$request.headers["x-apple-store-front"]),A.query?.sf&&(A.query.sf=s.Storefront.get(e.CountryCode[a])??A.query.sf),A.query?.locale&&(A.query.locale=s.Locale.get(e.CountryCode[a])??A.query.locale),$request.headers?.Host&&($request.headers.Host=A.host),$request.url=O.stringify(A);case!1:}})().catch((e=>T.logErr(e))).finally((()=>{if(T.log(`üéâ ${T.name}, finally`,"$request",`FORMAT: ${L}`,""),T.isQuanX())switch(L){case void 0:T.done({url:$request.url,headers:$request.headers});break;default:T.done({url:$request.url,headers:$request.headers,body:$request.body});break;case"application/protobuf":case"application/x-protobuf":case"application/vnd.google.protobuf":case"application/grpc":case"application/grpc+proto":case"applecation/octet-stream":T.done({url:$request.url,headers:$request.headers,bodyBytes:$request.bodyBytes.buffer.slice($request.bodyBytes.byteOffset,$request.bodyBytes.byteLength+$request.bodyBytes.byteOffset)})}else T.done($request)}))})();